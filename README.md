# ğŸš€ TS-Mock-Proxy

TS-Mock-Proxy is a "Zero-Config" mock server that instantly generates a functional REST API from your TypeScript interfaces. Stop wasting time configuring complex tools or waiting for the backend: your types are your documentation and your server.

## ğŸ¯ Project Goal

Enable Front-end developers to work in total isolation by intercepting API calls and responding with random but coherent data, based strictly on the project's interfaces.

---

## ğŸ›  Technical Stack

**Core**
- **Language** : TypeScript (strict mode)
- **Runtime** : Node.js 24+
- **Package Manager** : npm

**Server & API**
- **Server** : Express
- **HTTP Proxy** : http-proxy-middleware
- **CORS** : cors
- **API Documentation** : Swagger UI Express (auto-generated from TypeScript interfaces)

**Data Generation**
- **Type Analysis** : Intermock (uses TypeScript AST to generate data) | https://github.com/google/intermock#readme
- **Random Data** : Faker-js (via Intermock) | http://fakerjs.dev/

**CLI & Tooling**
- **CLI** : Commander.js | https://github.com/tj/commander.js#readme
- **File Watching** : chokidar (hot-reload) | https://github.com/paulmillr/chokidar
- **Logging** : chalk | https://github.com/chalk/chalk#readme

**Development**
- **Tests** : Jest + ts-jest
- **TS Execution** : tsx (faster than ts-node)
- **Dev Mode** : nodemon + tsx

---

## ğŸš€ Quick Start

### Installation

```bash
# Clone the project
git clone <repo-url>
cd ts-mock-proxy

# Install dependencies
npm install

# Build the project
npm run build
```

### Usage

#### 1ï¸âƒ£ Define your TypeScript contracts

```typescript
// contracts/user.ts
export interface User {
  id: number;
  name: string;
  email: string;
  role: 'admin' | 'user';
}

// contracts/product.ts
export interface Product {
  id: string;
  title: string;
  price: number;
  inStock: boolean;
}
```

#### 2ï¸âƒ£ Start the mock server

```bash
# Development mode with hot-reload
npm run dev

# Or with custom options
npx tsx src/index.ts --dir ./contracts --port 8080 --hot-reload --latency 500-1500
```

#### 3ï¸âƒ£ Call your API

```bash
# Single object
curl http://localhost:8080/user
# â†’ {"id": 482, "name": "John Doe", "email": "john.d@gmail.com", "role": "admin"}

# Array of objects (plural)
curl http://localhost:8080/users
# â†’ [{"id": 1, ...}, {"id": 2, ...}, ...]

# With nested routes
curl http://localhost:8080/api/v1/product
# â†’ {"id": "abc123", "title": "Product Name", "price": 29.99, "inStock": true}
```

#### ğŸ“š Swagger UI - API Documentation

The mock server automatically generates an **interactive API documentation** using Swagger/OpenAPI:

```bash
# Access the Swagger UI at:
http://localhost:8080/api-docs
```

**Features**:
- ğŸ“– Auto-generated documentation from your TypeScript interfaces
- ğŸ¯ Interactive UI to test endpoints directly from your browser
- ğŸ” View all available endpoints (single object and arrays)
- ğŸ“ See request/response schemas with examples
- âš¡ Real-time updates when contracts change (with hot-reload enabled)

**Available endpoints**:
- `/health` - Server health check and configuration info
- `/{interfaceName}` - Get a single mocked object (e.g., `/user`, `/product`)
- `/{interfaceNames}` - Get an array of mocked objects (e.g., `/users`, `/products`)

The Swagger spec is automatically generated by scanning all exported TypeScript interfaces in your contracts directory.

#### 4ï¸âƒ£ Proxy Mode (optional)

```bash
# Redirects to the real backend if the type doesn't exist
npx tsx src/index.ts --target https://api.example.com
```

#### 5ï¸âƒ£ Use types from an external project

```bash
# Point to the types folder of another project (backend, shared repo, etc.)
npx tsx src/index.ts --external-dir /path/to/backend-project/src/types

# Use multiple external sources
npx tsx src/index.ts --external-dir ../backend/types --external-dir ../shared-contracts

# Absolute path (Windows)
npx tsx src/index.ts --external-dir "C:\Users\dev\backend-api\src\types"

# Relative path (parent directory)
npx tsx src/index.ts --external-dir ../my-backend/src/types
```

**Benefits**:
- âœ… No duplication: use your backend types directly
- âœ… Automatic synchronization: changes in the source project are detected (with `--hot-reload`)
- âœ… Single Source of Truth: backend types are the unique reference
- âœ… Compatible with mono-repos or separate projects

**Example**: React Frontend + NestJS Backend
```bash
# In your frontend project
cd my-frontend
npx tsx src/index.ts --external-dir ../my-backend/src/dto --port 3001

# The mock server will scan:
# 1. ./contracts (your local overrides)
# 2. ../my-backend/src/dto (the real backend types)
```

ğŸ“– **Complete documentation**: see [EXTERNAL_TYPES.md](./EXTERNAL_TYPES.md)

---

## âš™ï¸ CLI Configuration

```bash
ts-mock-proxy [options]

Options:
  --dir <path>              Path to TypeScript contracts directory (default: ./contracts)
  --external-dir <paths>    External directories to scan (separate project or repo) - can be used multiple times
  --port <number>           Server port (default: 8080)
  --target <url>            Real backend URL for proxy mode (optional)
  --latency <ms>            Simulated latency min-max (e.g., 500-2000)
  --hot-reload              Enable file hot-reload
  --cache                   Enable schema caching
  --verbose                 Verbose mode for logging
```

### NPM Scripts

```bash
npm run dev              # Start the server in development mode
npm run dev:external     # Start with an external directory (example)
npm run build            # Compile TypeScript to dist/
npm start                # Start the server in production (after build)
npm test                 # Run Jest tests
npm run test:watch       # Tests in watch mode
npm run test:coverage    # Coverage report
npm run clean            # Remove dist/ folder
```

---

## ğŸ“– How It Works

### Naming Conventions (Route â†” Type)

| Requested URL | Type searched | Mode |
|--------------|----------------|------|
| `/user` | `User` | Single object |
| `/users` | `User` | Array of objects |
| `/api/customer` | `Customer` | Single object |
| `/api/customers` | `Customer` | Array of objects |

**Algorithm**:
1. Extract the last segment of the URL (`/api/users` â†’ `users`)
2. Convert to PascalCase and singularize (`users` â†’ `User`)
3. Search for the corresponding interface in the files
4. If plural detected, return an array of 3-10 objects

### Cache & Performance

- **In-memory cache**: Map<string, ParsedSchema> to avoid re-parsing on each request
- **Invalidation**: The file watcher invalidates the cache when a .ts file changes
- **TTL**: Optional, configurable (default infinite in dev)

### Error Handling

- Type not found â†’ **404** with clear message
- Parsing error â†’ **500** with TypeScript error details
- Backend unreachable (proxy mode) â†’ **502** Bad Gateway

---

## ğŸ— Project Architecture

```
ts-mock-proxy/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Entry point (CLI with Commander)
â”‚   â”œâ”€â”€ server.ts             # Express server configuration and startup
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ parser.ts         # Type extraction with Intermock
â”‚   â”‚   â”œâ”€â”€ router.ts         # Dynamic routing and URL <-> Type matching
â”‚   â”‚   â”œâ”€â”€ proxy.ts          # Fallback logic to real backend
â”‚   â”‚   â”œâ”€â”€ cache.ts          # In-memory cache for TypeScript schemas
â”‚   â”‚   â””â”€â”€ swagger.ts        # OpenAPI spec generation from TypeScript interfaces
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”‚   â”œâ”€â”€ latency.ts        # Latency simulator
â”‚   â”‚   â”œâ”€â”€ statusOverride.ts # HTTP status override via header
â”‚   â”‚   â””â”€â”€ logger.ts         # Request logging
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ typeMapping.ts    # Naming conventions (route -> type)
â”‚   â”‚   â”œâ”€â”€ fileWatcher.ts    # Hot-reload with chokidar
â”‚   â”‚   â””â”€â”€ pluralize.ts      # Singular/plural handling
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ config.ts         # Configuration types
â”œâ”€â”€ contracts/                # TypeScript interface examples
â”‚   â””â”€â”€ user.ts
â”œâ”€â”€ dist/                     # Compiled code (generated by `npm run build`)
â”œâ”€â”€ tests/                    # Jest tests
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ jest.config.js
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## ğŸ—ºï¸ Roadmap - Upcoming Features

### ğŸ”œ Git Support - Fetch from GitHub

Ability to automatically clone a GitHub repository containing types, for even more flexibility.

**Planned usage**:
```bash
# Clone a GitHub repo and use its types
ts-mock-proxy \
  --git-repo https://github.com/company/api-contracts \
  --git-path src/types \
  --git-branch main
```

**Benefits**:
- ğŸ“¦ No need to have the backend project locally
- ğŸ”„ Automatic synchronization with remote repo
- ğŸŒ Ideal for teams with shared contract repos

**Use cases**:
- Team with a centralized contract repo (`company/shared-contracts`)
- Frontend wanting to use backend types without cloning manually
- CI/CD generating a mock server from a remote repo

### ğŸ”œ Configuration File

Support for a `ts-mock-proxy.config.json` file for advanced configurations:

```json
{
  "sources": [
    { "type": "local", "path": "./contracts" },
    { "type": "external", "path": "../backend/types" },
    { "type": "git", "url": "github.com/company/contracts", "branch": "main" }
  ],
  "port": 8080,
  "latency": { "min": 500, "max": 2000 },
  "cache": true,
  "exclude": ["**/*.test.ts", "**/internal/**"]
}
```

---

## ğŸ“„ License

MIT
